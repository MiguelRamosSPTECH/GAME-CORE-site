<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Criar Cargo</title>
    <link rel="stylesheet" href="css/cadastro_login.css">
    <script src="./js/sessao.js"></script>
    <script src="./js/alerta.js"></script>
</head>

<body>
    <header>
        <div class="container topbar">
            <div class="nome">
                <a href="index.html"><h3>GameCore</h3></a>
                <div class="links">
                    <nav>
                        <ul>
                            <!-- <li><a href="index.html">Home</a></li> -->
                        </ul>
                    </nav>
                </div>
            </div>


            <div class="itens">

                <div class="header_botoes">
                    <a class="botao" href="servidor.html"><b>SERVIDOR</b></a>
                    <a class="botao" href="dashSuporte.html">DASHBOARD SUPORTE</a>
                    <a class="botao" href="dashAnalista.html">DASHBOARD ANALISTA</a>
                    <a class="botao botao-ativado" href="funcionario.html">FUNCIONÁRIOS</a>
                </div>

            </div>

        </div>
    </header>

    <main class="gradiente">

        <div class="alerta_erro">
            <div class="card_erro" id="cardErro">
                <span id="mensagem_erro"></span>
            </div>
        </div>

        <div class="formulario">
            <h1>CRIAR CARGO</h1><br><br>
            <div class="campo">
                <label for="ipt_cargo">Nome do cargo</label>
                <input type="text" id="ipt_cargo"><br><br>
            </div>
            <h2>Permissões</h2>
            <p>Escolha o que o cargo pode ou não acessar!</p>
            <br>
            <div id="permissoes">
                <label class="label-permissoes">
                    <input type="checkbox" name="permissoes" value="dashboard_analista">
                    Dashboard Analista
                </label>

                <label class="label-permissoes">
                    <input type="checkbox" name="permissoes" value="dashboard_suporte">
                    Dashboard Suporte
                </label>

                <label class="label-permissoes">
                    <input type="checkbox" name="permissoes" value="cadastro_funcionario">
                    Cadastro Funcionário
                </label>

                <label class="label-permissoes">
                    <input type="checkbox" name="permissoes" value="criar_cargo">
                    Edição de Funcionário
                </label>

                <label class="label-permissoes">
                    <input type="checkbox" name="permissoes" value="cadastro_servidor">
                    Cadastro Servidor
                </label>

                <label class="label-permissoes">
                    <input type="checkbox" name="permissoes" value="criar_cargo">
                    Criação de Cargo
                </label>
            </div>

            <div id="div_aguardar" class="loading-div">
                <img src="./assets/circle-loading.gif" id="loading-gif" />
            </div>

            <button class="botao" onclick="cadastrar()">Cadastrar</button>
        </div>
    </main>

    <footer>
        <div class="footer_nome">GameCore</div>
        <div class="footer_links">
            <a href="index.html">Home</a>
        </div>
    </footer>

</body>

<script>

    function cadastrar(){
        let cargoVar = ipt_cargo.value;
        let fk_empresaVar = sessionStorage.FK_EMPRESA;
        
        console.log(cargoVar);

        let permissoesSelecionadas = []

        document.querySelectorAll("input[type=checkbox]:checked").forEach(c => {
            permissoesSelecionadas.push(c.value)
        })

        fetch("/cargos/criar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                cargoServer: cargoVar,
                jsonServer: permissoesSelecionadas,
                fk_empresaServer: fk_empresaVar
            })
            
        })
            .then(function (resposta){
                console.log("Resposta: ", resposta);
                
                if(resposta.ok){
                    cardErro.style.display = "block";

                    mensagem_erro.innerHTML =
                        "Cargo criado com sucesso!";
                        setTimeout(() => {
                        // window.location = "login.html";
                    }, "2000");
                    limparFormulario();
                }
                else {
                    throw "Houve um erro ao tentar criar o cargo!";
                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
                finalizarAguardar();
            });

            return false;
    }

    
</script>